<div class="cloud-save-status" [class]="getStatusClass()" *ngIf="shouldShowStatus"
    [title]="getTooltipText()">
    <div class="cloud-icon-wrapper" [class.spinning]="autosaveState.status === 'saving'">
        
        <!-- Saved state - Green cloud with checkmark -->
        <svg *ngIf="autosaveState.status === 'saved'" class="cloud-icon saved" width="22" height="16" viewBox="0 0 22 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11 0.900024C14.0605 0.900024 16.6068 3.16775 17.209 6.19202C19.3943 6.39148 21.1004 8.29267 21.1006 10.6246C21.1006 13.0901 19.1936 15.1001 16.834 15.1002H6C3.18208 15.1 0.900391 12.6963 0.900391 9.74963C0.900577 7.018 2.85758 4.75383 5.39355 4.44202C6.45854 2.33768 8.56912 0.900179 11 0.900024ZM11 2.85022C8.94977 2.8504 7.22787 4.29414 6.68848 6.276L6.66895 6.35022H6C4.21841 6.35044 2.7668 7.86678 2.7666 9.74963C2.7666 11.6327 4.21828 13.1498 6 13.15H16.834C18.1574 13.1499 19.2334 12.0265 19.2334 10.6246C19.2332 9.22298 18.1573 8.10037 16.834 8.10022H15.4834V7.56213C15.4832 4.95289 13.4734 2.85022 11 2.85022Z" fill="#22c55e"/>
            <g transform="translate(7, 5) scale(0.8)">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M8 0.947369L3 6L0 3.2887L0.942809 2.39551L3 4.10526L7 0L8 0.947369Z" fill="#22c55e"/>
            </g>
        </svg>

        <!-- Saving state - Animated cloud with spinner -->
        <svg *ngIf="autosaveState.status === 'saving'" class="cloud-icon saving" width="22" height="16" viewBox="0 0 22 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11 0.900024C14.0605 0.900024 16.6068 3.16775 17.209 6.19202C19.3943 6.39148 21.1004 8.29267 21.1006 10.6246C21.1006 13.0901 19.1936 15.1001 16.834 15.1002H6C3.18208 15.1 0.900391 12.6963 0.900391 9.74963C0.900577 7.018 2.85758 4.75383 5.39355 4.44202C6.45854 2.33768 8.56912 0.900179 11 0.900024ZM11 2.85022C8.94977 2.8504 7.22787 4.29414 6.68848 6.276L6.66895 6.35022H6C4.21841 6.35044 2.7668 7.86678 2.7666 9.74963C2.7666 11.6327 4.21828 13.1498 6 13.15H16.834C18.1574 13.1499 19.2334 12.0265 19.2334 10.6246C19.2332 9.22298 18.1573 8.10037 16.834 8.10022H15.4834V7.56213C15.4832 4.95289 13.4734 2.85022 11 2.85022Z" fill="#3b82f6"/>
            <circle cx="11" cy="8" r="2" stroke="white" stroke-width="1" fill="none" opacity="0.8">
                <animate attributeName="r" values="1;2;1" dur="1s" repeatCount="indefinite" />
            </circle>
        </svg>

        <!-- Error state - Red cloud with X -->
        <svg *ngIf="autosaveState.status === 'error'" class="cloud-icon error" width="22" height="16" viewBox="0 0 22 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11 0.900024C14.0605 0.900024 16.6068 3.16775 17.209 6.19202C19.3943 6.39148 21.1004 8.29267 21.1006 10.6246C21.1006 13.0901 19.1936 15.1001 16.834 15.1002H6C3.18208 15.1 0.900391 12.6963 0.900391 9.74963C0.900577 7.018 2.85758 4.75383 5.39355 4.44202C6.45854 2.33768 8.56912 0.900179 11 0.900024ZM11 2.85022C8.94977 2.8504 7.22787 4.29414 6.68848 6.276L6.66895 6.35022H6C4.21841 6.35044 2.7668 7.86678 2.7666 9.74963C2.7666 11.6327 4.21828 13.1498 6 13.15H16.834C18.1574 13.1499 19.2334 12.0265 19.2334 10.6246C19.2332 9.22298 18.1573 8.10037 16.834 8.10022H15.4834V7.56213C15.4832 4.95289 13.4734 2.85022 11 2.85022Z" fill="#ef4444"/>
            <g transform="translate(7, 5) scale(0.8)">
                <path d="M8 0.947369L3 6L0 3.2887L0.942809 2.39551L3 4.10526L7 0L8 0.947369Z" fill="#ef4444"/>
                <path d="M3.5 2.5L4.5 3.5M4.5 2.5L3.5 3.5" stroke="#ef4444" stroke-width="1" stroke-linecap="round"/>
            </g>
        </svg>

        <!-- Idle state - Gray cloud -->
        <svg *ngIf="autosaveState.status === 'idle'" class="cloud-icon idle" width="22" height="16" viewBox="0 0 22 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11 0.900024C14.0605 0.900024 16.6068 3.16775 17.209 6.19202C19.3943 6.39148 21.1004 8.29267 21.1006 10.6246C21.1006 13.0901 19.1936 15.1001 16.834 15.1002H6C3.18208 15.1 0.900391 12.6963 0.900391 9.74963C0.900577 7.018 2.85758 4.75383 5.39355 4.44202C6.45854 2.33768 8.56912 0.900179 11 0.900024ZM11 2.85022C8.94977 2.8504 7.22787 4.29414 6.68848 6.276L6.66895 6.35022H6C4.21841 6.35044 2.7668 7.86678 2.7666 9.74963C2.7666 11.6327 4.21828 13.1498 6 13.15H16.834C18.1574 13.1499 19.2334 12.0265 19.2334 10.6246C19.2332 9.22298 18.1573 8.10037 16.834 8.10022H15.4834V7.56213C15.4832 4.95289 13.4734 2.85022 11 2.85022Z" fill="#6b7280"/>
            <g transform="translate(7, 5) scale(0.8)" *ngIf="autosaveState.hasUnsavedChanges">
                <circle cx="4" cy="3" r="1.5" fill="#f59e0b" opacity="0.8"/>
            </g>
        </svg>
    </div>

    <!-- Status text (optional) -->
    <div class="status-text" *ngIf="showStatusText">
        <span [ngClass]="getStatusClass()">{{ getStatusText() }}</span>
    </div>
</div>

<!-- Debug info (always show for debugging) -->
<!-- <div class="debug-info" style="font-size: 10px; color: #666; margin-top: 4px; position: absolute; top: 100%; left: 0; background: white; padding: 4px; border: 1px solid #ccc; border-radius: 3px; z-index: 1000; white-space: nowrap;">
    Status: {{ autosaveState.status }} | Changes: {{ autosaveState.hasUnsavedChanges ? 'Yes' : 'No' }} | Time: {{ autosaveState.lastSaved ? (autosaveState.lastSaved | date:'HH:mm:ss') : 'Never' }}
</div> -->